
\section{Evaluation}

We evaluate the effectiveness of our analysis in two ways.
Section~\ref{XXX} compares the performance on major Javascript benchmarks
of a single compiler which does or doesn't use analyzed type information.
Section~\ref{XXX} examines the behavior of the analysis on a selection of
websites which heavily use Javascript, to gauge the effectiveness of the
analysis in practice.

\subsection{Benchmark Performance}

As described in Section~\ref{XXX}, we have integrated our analysis into
the Jaegermonkey JIT compiler used in Firefox.
We compare performance of the compiler used both without the analysis (JM)
and with the analysis (JM+TI).
JM+TI adds several major optimizations to JM (Section~\ref{XXX}),
and requires additional compilations due to dynamic type changes
(Section~\ref{XXX}).
Figure~\ref{XXX} shows the effect of these changes on the popular
SunSpider Javascript benchmark \cite{XXX}.

The JM and JM+TI sections of Figure~\ref{XXX} show the total amount of time
spent compiling and the total number of compilations for both versions of
the compiler.
For JM+TI, compilation time also includes time spent generating and solving
type constraints, which is small: 4ms for the entire benchmark.
JM performs 146 compilations, while JM+TI performs 224, an increase of 78.
The total compilation time for JM+TI is 2.52 times that of JM, an increase
of 32ms, due a combination of recompilations, type analysis and the extra
complexity of the added optimizations.

Despite the significant extra compilation cost, the type-based optimizations
performed by JM+TI quickly pay for themselves. The $\times$1 and
$\times$20 sections
of Figure~\ref{XXX} show the running times of the two versions of the
compiler on the benchmark run once and modified to run twenty times,
respectively.
In the single run case JM+TI is a 6.3\% improvement over JM.
One run of SunSpider completes in less than 250ms, which makes it
difficult to get an optimization to pay for itself on this benchmark.
Javascript heavy webpages are typically viewed for longer than
$\frac{1}{4}$ of a second, and longer execution times better show the effect
of type based optimizations.
When run twenty times, the speedup given by JM+TI increases to 27.1\%.

Figures~\ref{XXX} and~\ref{XXX} compare the performance of JM and JM+TI
on two other popular benchmarks, the V8 \cite{XXX} and Kraken \cite{XXX} suites.
These suites run for several seconds each, far longer than SunSpider,
and show a larger speedup.
V8 scores (which are given as a rate, rather than a raw time) improve by 50\%,
and Kraken scores improve by a factor of 2.69.

\begin{figure*}
\begin{center}
\begin{tabular}{lr@{.}lrr@{.}lrr@{.}lr@{.}lr@{.}lr@{.}lr@{.}lr@{.}lr@{.}l}

\toprule

           & \multicolumn{3}{c}{JM}
           & \multicolumn{3}{c}{JM+TI}
           & \multicolumn{2}{c}{}
           & \multicolumn{6}{c}{$\times$1 Times (ms)}
           & \multicolumn{6}{c}{$\times$20 Times (ms)} \\

\cmidrule(r){2-4}
\cmidrule{5-7}
\cmidrule(r){10-15}
\cmidrule{16-21}

Test       & \multicolumn{2}{c}{Time (ms)} & \#
           & \multicolumn{2}{c}{Time (ms)} & \#
           & \multicolumn{2}{c}{Ratio}
           & \multicolumn{2}{c}{JM}
           & \multicolumn{2}{c}{JM+TI}
           & \multicolumn{2}{c}{Ratio}
           & \multicolumn{2}{c}{JM}
           & \multicolumn{2}{c}{JM+TI}
           & \multicolumn{2}{c}{Ratio} \\

\midrule

3d-cube                  & 2&68 & 15 & 8&21 & 24 & 3&06
    & 14&1 & 16&6 & 1&18 & 226&9 & 138&8 & 0&61 \\
3d-morph                 & 0&55 & 2   & 1&59 & 7  & 2&89 
    & 9&8  & 10&3 & 1&05 & 184&7 & 174&6 & 0&95 \\
3d-raytrace              & 2&25 & 19 & 6&04 & 22 & 2&68
    & 14&7 & 15&6 & 1&06 & 268&6 & 152&2 & 0&57 \\
access-binary-trees      & 0&63 & 4   & 1&03 & 7  & 1&63
    & 6&1  & 5&2 & 0&85   & 101&4 & 70&8  & 0&70 \\
access-fannkuch          & 0&65  & 1  & 2&43 & 4  & 3&76
    & 15&3 & 10&1 & 0&66  & 289&9 & 113&7 & 0&39 \\
access-nbody             & 1&01 & 5  & 1&49 & 5  & 1&47
    & 9&9  & 5&3 & 0&54   & 175&6 & 73&2  & 0&42 \\
access-nsieve            & 0&28 & 1   & 0&63 & 2   & 2&25
    & 6&9  & 4&5 & 0&65   & 143&1 & 90&7  & 0&63 \\
bitops-3bit-bits-in-byte & 0&28 & 2   & 0&58 & 3   & 2&07
    & 1&7  & 0&8 & 0&47    & 29&9 & 10&0   & 0&33 \\
bitops-bits-in-byte      & 0&29 & 2   & 0&54 & 3   & 1&86
    & 7&0  & 4&8 & 0&69   & 139&4 & 85&4  & 0&61 \\
bitops-bitwise-and       & 0&24 & 1   & 0&39 & 1   & 1&63
    & 6&1  & 3&1 & 0&51   & 125&2 & 63&7  & 0&51 \\
bitops-nsieve-bits       & 0&35 & 1   & 0&73 & 2   & 2&09
    & 6&0  & 3&6 & 0&60    & 116&1 & 63&9  & 0&55 \\
controlflow-recursive    & 0&38 & 3   & 0&65 & 6   & 1&71
    & 2&6  & 2&7 & 1&04  & 49&4  & 42&3  & 0&86 \\
crypto-aes               & 2&04 & 14 & 6&61 & 23 & 3&24
    & 9&3  & 10&9 & 1&17 & 162&6 & 107&7 & 0&66 \\
crypto-md5               & 1&81 & 9  & 3&42 & 13 & 1&89
    & 6&1  & 6&0 & 0&98   & 62&0  & 27&1  & 0&44 \\
crypto-sha1              & 0&88 & 7   & 2&46 & 11 & 2&80
    & 3&1  & 4&0 & 1&29  & 44&2  & 19&4  & 0&44 \\
date-format-tofte        & 0&93 & 21  & 2&27 & 24 & 2&44
    & 16&4 & 18&3 & 1&12 & 316&6 & 321&8 & 1&02 \\
date-format-xparb        & 0&88 & 7   & 1&26 & 6  & 1&43
    & 11&6 & 14&8 & 1&28 & 219&4 & 285&1 & 1&30 \\
math-cordic              & 0&45 & 3   & 0&94 & 5   & 2&09
    & 7&4  & 3&4 & 0&46   & 141&0 & 50&3  & 0&36 \\
math-partial-sums        & 0&47 & 1   & 1&03 & 3  & 2&19
    & 14&1 & 12&4 & 0&88  & 278&4 & 232&6 & 0&84 \\
math-spectral-norm       & 0&54 & 5   & 1&39 & 9  & 2&57
    & 5&0  & 3&4 & 0&68   & 92&6  & 51&2  & 0&55 \\
regexp-dna               & 0&00 & 0   & 0&00 & 0    & 0&00
    & 16&3 & 16&1 & 0&99  & 254&5 & 268&8 & 1&06 \\
string-base64            & 0&87 & 3   & 1&90 & 5   & 2&18
    & 7&8  & 6&5 & 0&83   & 151&9 & 103&6 & 0&68 \\
string-fasta             & 0&59 & 4   & 1&70 & 9   & 2&88
    & 10&0 & 7&3 & 0&73   & 124&0 & 93&4  & 0&75 \\
string-tagcloud          & 0&54 & 4   & 1&54 & 6  & 2&85
    & 21&0 & 24&3 & 1&16 & 372&4 & 433&4 & 1&17 \\
string-unpack-code       & 0&89 & 8   & 2&65 & 16 & 2&98
    & 24&4 & 26&7 & 1&09 & 417&6 & 442&5 & 1&06 \\
string-validate-input    & 0&58 & 4   & 1&65 & 8  & 2&84
    & 10&2 & 9&5 & 0&93   & 216&6 & 184&1 & 0&85 \\

\midrule

Total                  & 21&06 & 146 & 53&13 & 224 & 2&52
    & 261&9 & 246&4 & 0&94 & 4703&6 & 3700&3 & 0&79 \\

\bottomrule

\end{tabular}
\end{center}
\nocaptionrule \caption{SunSpider-0.9.1 Benchmark Results}
\end{figure*}

\begin{figure}
\begin{center}
\begin{tabular}{lr@{.}lr@{.}lr@{.}l}

\toprule

Test & \multicolumn{2}{c}{JM}
     & \multicolumn{2}{c}{JM+TI}
     & \multicolumn{2}{c}{Ratio} \\

\midrule

ai-astar & 889&4 & 137&8 & 0&15 \\
audio-beat-detection & 641&0 & 374&8 & 0&58 \\
audio-dft & 627&8 & 352&6 & 0&56 \\
audio-fft & 494&0 & 229&8 & 0&47 \\
audio-oscillator & 518&0 & 221&2 & 0&43 \\
imaging-gaussian-blur & 4351&4 & 730&0 & 0&17 \\
imaging-darkroom & 699&6 & 586&8 & 0&84 \\
imaging-desaturate & 821&2 & 209&2 & 0&25 \\
json-parse-financial & 116&6 & 119&2 & 1&02 \\
json-stringify-tinderbox & 80&0 & 78&8 & 0&99 \\
crypto-aes & 201&6 & 158&0 & 0&78 \\
crypto-ccm & 127&8 & 133&6 & 1&05 \\
crypto-pbkdf2 & 454&8 & 350&2 & 0&77 \\
crypto-sha256-iterative & 153&2 & 106&2 & 0&69 \\
\midrule
Total & 10176&4 & 3778&2 & 0&37 \\
\bottomrule
\end{tabular}
\end{center}
\nocaptionrule \caption{Kraken-1.1 Benchmark Results}
\end{figure}

\begin{figure}
\begin{center}
\begin{tabular}{lrrr@{.}l}
\toprule
Test & JM & JM+TI & \multicolumn{2}{c}{Ratio} \\
\midrule
Richards & 4497 & 7152 & 1&59 \\
DeltaBlue & 3250 & 9087 & 2&80 \\
Crypto & 5205 & 13376 & 2&57 \\
RayTrace & 3733 & 3217 & 0&86 \\
EarleyBoyer & 4546 & 6291 & 1&38 \\
RegExp & 1547 & 1316 & 0&85 \\
Splay & 4775 & 7049 & 1&48 \\
\midrule
Total & 3702 & 5555 & 1&50 \\
\bottomrule
\end{tabular}
\end{center}
\nocaptionrule \caption{V8 (version 6) Benchmark Results}
\end{figure}

\begin{figure*}
\begin{center}
\begin{tabular}{lrrrrrrrrrrrrrrr}
\toprule
& \multicolumn{4}{c}{Inferred Precision (\%)}
& \multicolumn{4}{c}{Arithmetic (\%)}
& \multicolumn{4}{c}{Indexes (\%)} \\

\cmidrule(r){2-5}
\cmidrule(r){6-9}
\cmidrule{10-13}

Test
& Mono & Di & Poly & Barrier
& Int & Double & Other & Unknown
& Int & Double & Other & Unknown \\
\midrule
gmail          & 78 & 5  & 17 & 47 & 62 & 9  & 7  & 21 & 44 & 0 & 47 & 8 \\
googlemaps     & 81 & 7  & 12 & 36 & 66 & 26 & 3  & 5  & 60 & 6 & 30 & 4 \\
facebook       & 73 & 11 & 16 & 42 & 43 & 0 & 40 & 16 & 62 & 0 & 32 & 6 \\
flickr         & 71 & 19 & 10 & 74 & 61 & 1 & 30 & 8 & 27 & 0 & 70 & 3 \\
grooveshark    & 64 & 15 & 21 & 63 & 65 & 1 & 13 & 21 & 28 & 0 & 56 & 16 \\
meebo          & 78 & 11 & 10 & 35 & 66 & 9 & 18 & 8 & 17 & 0 & 34 & 49 \\
reddit         & 71 & 7 & 22 & 51 & 64 & 0 & 29 & 7 & 22 & 0 & 71 & 7 \\
youtube        & 83 & 11 & 6 & 38 & 50 & 27 & 19 & 4 & 33 & 0 & 38 & 29 \\
ztype          & 91 & 1 & 9 & 52 & 43 & 41 & 8 & 8 & 79 & 9 & 12 & 0 \\
280slides      & 79 & 3 & 19 & 64 & 48 & 51 & 1 & 0 & 6 & 0 & 91 & 2 \\
membench50     & 76 & 11 & 13 & 49 & 65 & 7  & 18 & 10 & 44 & 0 & 47 & 10 \\
sunspider      & 99 & 0  & 1  & 7  & 72 & 21 & 7  & 0  & 95 & 0 & 4  & 1  \\
v8bench        & 86 & 7  & 7  & 26 & 98 & 1  & 0  & 0  & 100 & 0 & 0 & 0  \\
kraken         & 100 & 0 & 0  & 3  & 61 & 37 & 2  & 0  & 100 & 0 & 0 & 0  \\
angrybirds     & 97 & 2 & 1 & 93 & 22 & 78 & 0 & 0 & 88 & 8 & 0 & 5 \\
gameboy        & 88 & 0 & 12 & 16 & 54 & 36 & 3 & 7 & 88 & 0 & 0 & 12 \\
bullet         & 84 & 0 & 16 & 92 & 54 & 38 & 0 & 7 & 79 & 20 & 0 & 1 \\
lights         & 97 & 1 & 2 & 15 & 34 & 66 & 0 & 1 & 95 & 0 & 4 & 1 \\
FOTN           & 98 & 1 & 1 & 20 & 39 & 61 & 0 & 0 & 96 & 0 & 3 & 0 \\
monalisa       & 99 & 1 & 0 & 4 & 94 & 3 & 2 & 0 & 100 & 0 & 0 & 0 \\
\bottomrule
\end{tabular}
\end{center}
\nocaptionrule \caption{Website Type Profiling Results}
\end{figure*}

\begin{figure}
\begin{center}
\begin{tabular}{lrrrrrr}
\toprule
     & \multicolumn{3}{c}{Element Accesses (\%)}
     & \multicolumn{3}{c}{Property Accesses (\%)} \\
\cmidrule(r){2-4}
\cmidrule{5-7}
Test & Packed & Dense & Uk
     & Static & PIC & Uk \\
\midrule
gmail          & 90 & 4 & 5 & 31 & 57 & 12 \\
googlemaps     & 92 & 1 & 7 & 18 & 77 & 5 \\
facebook       & 16 & 68 & 16 & 41 & 53 & 6 \\
flickr         & 27 & 0 & 73 & 33 & 53 & 14 \\
grooveshark    & 90 & 2 & 8 & 20 & 66 & 14 \\
meebo          & 57 & 0 & 43 & 40 & 57 & 3 \\
reddit         & 97 & 0 & 3 & 45 & 51 & 4 \\
youtube        & 100 & 0 & 0 & 32 & 49 & 19 \\
ztype          & 100 & 0 & 0 & 23 & 76 & 0 \\
280slides      & 88 & 12 & 0 & 23 & 56 & 21 \\
membench50     & 80 & 4 & 16 & 35 & 58 & 6 \\
sunspider      & 93 & 6 & 1 & 81 & 19 & 0 \\
v8bench        & 7 & 93 & 0 & 64 & 36 & 0 \\
kraken         & 99 & 0 & 0 & 96 & 4 & 0 \\
angrybirds     & 90 & 0 & 10 & 22 & 76 & 2 \\
gameboy        & 98 & 0 & 2 & 6 & 94 & 0 \\
bullet         & 4 & 96 & 0 & 32 & 65 & 3 \\
lights         & 97 & 3 & 1 & 21 & 78 & 1 \\
FOTN           & 91 & 6 & 3 & 46 & 54 & 0 \\
monalisa       & 87 & 0 & 13 & 78 & 22 & 0 \\
\bottomrule
\end{tabular}
\end{center}
\nocaptionrule \caption{Element/Property Access Precision}
\end{figure}

\begin{figure}
\begin{center}
\begin{tabular}{lrrrrrrr}
\toprule
     & \multicolumn{3}{c}{Inferred Precision (\%)}
     & \multicolumn{4}{c}{Unknown Ops (\%)} \\
\cmidrule(r){2-4}
\cmidrule{5-8}
Test & Mono & Di & Poly & A & I & E & P \\
\midrule
280slides      & 23 & 1 & 76 & 93 & 7 & 9 & 27 \\
gmail          & 52 & 2 & 46 & 32 & 39 & 47 & 12 \\
googlemaps     & 60 & 2 & 38 & 23 & 33 & 25 & 5 \\
facebook       & 49 & 2 & 48 & 20 & 24 & 30 & 6 \\
flickr         & 36 & 2 & 61 & 39 & 15 & 74 & 18 \\
grooveshark    & 38 & 4 & 58 & 30 & 23 & 19 & 15 \\
meebo          & 56 & 8 & 36 & 28 & 58 & 39 & 3 \\
reddit         & 59 & 3 & 37 & 13 & 45 & 17 & 4 \\
youtube        & 57 & 3 & 40 & 28 & 33 & 0 & 19 \\
ztype          & 46 & 0 & 54 & 63 & 47 & 95 & 5 \\
membench50     & 49 & 5 & 47 & 29 & 24 & 29 & 6 \\
sunspider      & 94 & 1 & 5 & 6 & 1 & 9 & 0 \\
v8bench        & 78 & 4 & 18 & 1 & 1 & 6 & 0 \\
kraken         & 98 & 0 & 2 & 2 & 1 & 2 & 0 \\
angrybirds     & 9 & 0 & 90 & 93 & 23 & 24 & 2 \\
gameboy        & 81 & 4 & 15 & 7 & 12 & 12 & 0 \\
bullet         & 38 & 0 & 62 & 79 & 59 & 0 & 3 \\
lights         & 51 & 12 & 37 & 63 & 9 & 14 & 0 \\
FOTN           & 70 & 2 & 28 & 57 & 3 & 30 & 0 \\
monalisa       & 56 & 1 & 44 & 41 & 0 & 16 & 0 \\
\bottomrule
\end{tabular}
\end{center}
\nocaptionrule \caption{Precision Without Barriers}
\end{figure}

\subsection{Website Performance}

TODO

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
